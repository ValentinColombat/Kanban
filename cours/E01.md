# Sécurité et architecture Client-Serveur

 ---

## Menu du jour

- Architecture :
  - **API/SPA** vs **SSR**
  - découverte de notre mono-dépôt

- Sécurité
  - Faille CSRF (et les CORS)
  - Faille XSS (et les sanitizers)
  - Faille SQL (et l'ORM)

- Slides
  - Résumé
  - Acteurs et ressources
  - Recommandations

- Challenge
  - Register (signup)

## SSR vs API/SPA

Ce qu'on a fait jusqu'à maintenant : une application `monolithique`

`Server-Side Rendering` : le serveur compile les données avec les vues et les envoie au client pour affichage.

Idée: calculer la page HTML côté serveur et l'envoyer au client.

**Avantages :**

- **Simplicité** : Un seul serveur applicatif à gérer.
- **Rapide** : 1 seul appel HTTP pour charger le contenu ( contre au moins 2 requêtes avec l'autre architecture )
- **Référencement** : Niveau SEO (Search Engine Optimization), les pages renvoyées par le serveur sont complètes (HTML structuré avec du contenu) -> les robots d'indexation peuvent lire notre site facilement et rapidement.

![img](../docs/SSR.png)

### API / SPA

Idée : renvoyer un page unique (SPA => Single Page Application), une coquille vide, capable d'aller chercher des données en communiquant avec une API, et en mettant à jour la vue en fonction des données qu'elle reçoit.
Quand on charge une page d'une SPA, **en réalité on ne change pas de page, on vire toutes les éléments HTML, et on les remplace par d'autres**

On découple le serveur de données et le front pour en faire deux application séparées.

**Avantages :**

- **SoC** : Separation of Concerns (Séparation des responsabilités)
- **Dynamisme**: lorsqu'on manipule les pages de l'application, il n'y a pas de rechargement de la page dans le sens ou le serveur nous renvoie une nouvelle page.
Le JS front repeint la page en fonction des données JSON qu'il reçoit.

**Inconvénients :** Le référencement est moins bon qu'avec le SSR, car les robots ne lisent pas le contenu aussi facilement (tous les robots d'indexation ne sont pas capables de lire le JS)

- **(Moins) Rapide** : plusieurs appels HTTP pour charge tous les contenus.

![img](../docs/API-SPA.png)

---

## AJAX & Fetch

- **AJAX :** Asynchronous JavaScript and XML, c'est une technique qui permet à JavaScript de faire des requêtes seul. Cette technique permet de demander des données à un serveur dans le but de modifier seulement une partie des pages web. Jadis, on utilisait l'objet `XMLHttpRequest`. <https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest>

- **fetch :** C'est la méthode moderne pour faire des requêtes AJAX. c'est une promesse.

Le but de cette technique est de rendre les pages web plus dynamiques.

### SOP & CORS

- **SOP :** Same Origin Policy
- **CORS :** Cross-Origin Resource Sharing

## Installation de l'application et récap

- Quand on démarre l'appli, le front n'affiche rien
  - On a mis en place la fonction `httpRequest` dans les services `lists` et `cards` du front.
  - On a mis en place les CORS sur l'api, si on ne met pas les cors, les requêtes ajax sont bloqués par défaut.
  - On s'est assuré que le front n'est pas vulnérable aux attaques `XSS` en évitant `innerHTML` ou équivalent.
  - On a ajouté le module `express-xss-sanitizer` afin de ne pas permettre aux balises script de rentrer en BDD.

---

>**Attention, on ne dit pas crypter, mais chiffrer**

## Différence entre http et https

### http

Le mode par défaut du web, on peut espionner et récupérer les infos qui transitent entre serveurs et clients.

### https

Les requêtes sont chiffrées, on ne peut pas intercepter les données qui transitent entre serveurs et clients.

<https://chiffrer.info/>
